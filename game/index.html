<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <!-- If the page is zoomed with pinch on mobile, it can be hard to undo since the canvas prevents the gesture, and hard to understand, and it can cause things to be cut off. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Snakeshift</title>
  <link rel="stylesheet" type="text/css" href="./index.css" />
  <!-- <link rel="icon" type="image/png" href="/graphics/yin-yang-smol-sneks-128px.png" sizes="128x128" /> -->
  <link rel="icon" type="image/png" href="/graphics/yin-yang-larger-sneks-180px.png" sizes="180x180" />
</head>

<body>

  <div id="debug-console" style="
    position: absolute;
    top: 0;
    left: 80px;
    right: 0;
    max-height: 100vh;
    overflow-y: auto;
    z-index: 1000;
    background-color: white;
    border: 1px solid black;
    color: black;
  ">
    <h3>Debug Console</h3>
    <pre id="debug-output" style="
      overflow-y: auto;
      background-color: white;
      border: 1px solid black;
      color: black;
      margin: 5px;
      min-height: 100px;
    ">
    </pre>
    <b>&gt;</b> <textarea type="text" id="debug-input" style="width: 90%;"></textarea>
  </div>
  <script>
    // Notes on Kindle 4.x browser:
    // - `onerror` or `addEventListener('error', ...)` is not supported! Very hard to tell what's going wrong.
    // - `const` is supported but may be treated like `var`
    // - `let` is not supported
    // - `for...of` is not supported
    // - `Array.from` and/or `Array.prototype.map` and/or `Array.prototype.join` is not supported
    // - `JSON` is not supported (I've tried to include a polyfill with @vitejs/plugin-legacy, but that's not working, maybe because this is just a script tag and not a module?)
    // - `{variableAsKey}` is not supported
    // - Canvas is supported

    const originalConsole = window.console
    window.console = {}

    function logOnPage(message) {
      const pre = document.getElementById('debug-output')
      const div = document.createElement('div')
      div.textContent = message
      pre.appendChild(div)
    }
    function logEverywhere(a, b, c, d) {
      // Format message
      //const message = Array.from(arguments).join(' ')
      //const args = new Array(arguments.length).map(i => arguments[i])
      //const message = args.join(' ')
      var message = ''
      for (var i = 0; i < arguments.length; i++) {
        message += arguments[i]
        if (i < arguments.length - 1) {
          message += ' '
        }
      }
      // Log on page
      logOnPage(message)
      // Log on devtools console
      try {
        const method = "log"
        originalConsole[method].apply(originalConsole, arguments)
      } catch (e) {
        logOnPage(e)
      }
      // Log on server
      try {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', '/log', true)
        //xhr.setRequestHeader('Content-Type', 'application/json')
        xhr.setRequestHeader('Content-Type', 'text/plain')
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status !== 200) {
              logOnPage('Failed to log on server: ' + xhr.status + ' ' + xhr.statusText + ' ' + xhr.responseText)
            }
          }
        }
        //xhr.send(JSON.stringify({ message: message }))
        //xhr.send(message)
      } catch (e) {
        logOnPage(e)
      }
    }

    //const methods = ['log', 'warn', 'error', 'debug', 'info', 'trace']
    //for (var i = 0; i < methods.length; i++) {
    //  const method = methods[i]

    console.log = logEverywhere
    console.warn = logEverywhere
    console.error = logEverywhere
    console.debug = logEverywhere
    console.info = logEverywhere
    console.trace = logEverywhere

    console.log("This is a log message")
    console.warn("This is a warning message")
    console.log("eval('1 + 1') is", eval('1 + 1'))
    console.log("window.addEventListener", window.addEventListener)
    console.log("window.onerror", window.onerror)

    //const methods = ['log', 'warn', 'error', 'debug', 'info', 'trace', 'table', 'group', 'groupCollapsed', 'groupEnd', 'time', 'timeEnd', 'timeLog', 'count', 'assert', 'clear', 'dir', 'dirxml', 'profile', 'profileEnd', 'timeStamp', 'context', 'memory', 'exception', 'table', 'group', 'groupCollapsed', 'groupEnd', 'time', 'timeEnd', 'timeLog', 'count', 'assert', 'clear', 'dir', 'dirxml']
    //for (var i = 0; i < methods.length; i++) {
    //  const method = methods[i]
    //  console.log(method)//, 'is', console[method] === originalConsole[method] ? 'the same as' : 'different from', 'original console.')
    //}
    try {
      const method = 'log'
      console.log(method, 'is', console[method] === originalConsole[method] ? 'the same as' : 'different from', 'original console.')
    } catch (e) {
      console.error(e)
    }

    function handleCommand(code) {
      console.log(">", code)
      try {
        const result = eval(code)
        console.log("<", result)
      } catch (e) {
        console.error(e)
      }
    }

    function sendCommand(code) {
      const xhr = new XMLHttpRequest()
      xhr.open('POST', '/command', true)
      xhr.setRequestHeader('Content-Type', 'text/plain')
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status !== 200) {
            logOnPage('Failed to send command to server: ' + xhr.status + ' ' + xhr.statusText + ' ' + xhr.responseText)
          }
        }
      }
      xhr.send(code)
    }

    var receivingCommands = true
    function receiveCommand(code) {
      if (!receivingCommands) {
        return
      }

      const xhr = new XMLHttpRequest()
      xhr.open('GET', '/get-command', true)
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            const code = xhr.responseText
            if (code) {
              handleCommand(code)
            }
          } else {
            logOnPage('Failed to receive command from server: ' + xhr.status + ' ' + xhr.statusText + ' ' + xhr.responseText)
          }
        }
      }
      xhr.send()
    }
    //setInterval(receiveCommand, 1000)

    const input = document.getElementById('debug-input')
    input.addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        const code = input.value
        handleCommand(code)
        receivingCommands = false
        sendCommand(code)
      }
    })
  </script>
  <button onclick="location.reload()" autofocus style="
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1000;
    ">Reload</button>

  <div class="screen safe-center active" id="main-menu">
    <main class="safe-center">
      <h1>Snake<span class="logo-shift">Shift</span></h1>
      <button class="bw-button" id="play-button" autofocus>
        <img src="/graphics/play.svg" alt="" />
        Play
      </button>
      <button class="bw-button" id="level-select-button">
        <img src="/graphics/level-select-2.svg" alt="" />
        Level Select
      </button>
      <button class="bw-button" id="level-editor-button">
        <img src="/graphics/level-info.svg" alt="" />
        Level Editor
      </button>
      <button class="bw-button" id="credits-button">
        <img src="/graphics/star.svg" alt="" />
        Credits
      </button>
    </main>
    <footer>
      <a href="https://isaiahodhner.io/games">More Games</a>
      &nbsp;&middot;&nbsp;
      <a href="https://www.paypal.com/paypalme/isaiahodhner">Donate</a>
    </footer>
  </div>
  <div class="screen safe-center" id="credits">
    <h1>Credits</h1>
    <p>
      <a href="https://isaiahodhner.io/games">Isaiah Odhner</a> ‚Äî Programming, Design, Art
    </p>
    <h2>Sound Effects</h2>
    <p>
      <a href="https://freesound.org/people/schreibsel/sounds/540162/">schreibsel (Freesound) ‚Äî Snake hiss</a>
    </p>
    <!-- <p>
      <a href="https://freesound.org/people/spt3125/sounds/24558/">spt3125 (Freesound) ‚Äî Kayageum</a>
    </p> -->
    <p>
      <a href="https://freesound.org/people/joseph.larralde/sounds/352493/">joseph.larralde (Freesound) ‚Äî
        Glockenspiel</a>
    </p>
    <p>
      <a href="https://pixabay.com/sound-effects/gong-2-232435/">LazyChillZone (Pixabay) ‚Äî Gong</a>
    </p>
    <p>
      <a href="https://freesound.org/people/JensZygar/sounds/486629/">JensZygar (Freesound) ‚Äî Final Gong</a>
    </p>
    <p>
      <a href="https://en.wikipedia.org/wiki/Lego_Creator_(video_game)">LEGO Creator</a> ‚Äî Undo/Redo (temporary)
    </p>
    <p>
      <a href="https://freesound.org/people/Riley_Garinger/sounds/736438/">Riley_Garinger (Freesound) ‚Äî Level resize</a>
    </p>
    <p>
      <a href="https://freesound.org/people/MindlessTrails/sounds/509532/">MindlessTrails (Freesound) ‚Äî Crate push</a>
    </p>
  </div>
  <div class="screen safe-center" id="level-select">
    <h2>Level Select</h2>
    <!-- If changing a level's id, add an upgrade step in initLocalStorage to preserve the player's solution status. -->
    <div id="level-list">
      <h3>Easy</h3>
      <button class="bw-button level-button" data-level="levels/easy/001-movement.json">
        Movement
      </button>
      <button class="bw-button level-button" data-level="levels/easy/002-switching-snakes.json">
        Switching Snakes
      </button>
      <button class="bw-button level-button" data-level="levels/easy/003-bridge.json">
        Bridge
      </button>
      <button class="bw-button level-button" data-level="levels/easy/004-ferry.json">
        Ferry
      </button>
      <button class="bw-button level-button" data-level="levels/easy/005-yin-yang-give-and-take.json">
        Yin and Yang: Give and Take
      </button>
      <button class="bw-button level-button" data-level="levels/easy/006-fill-the-box-further-too-many-solutions.json">
        Fill The Box
      </button>
      <button class="bw-button level-button" data-level="levels/easy/007-north-star.json">
        North Star
      </button>
      <h3>Medium</h3>
      <button class="bw-button level-button" data-level="levels/medium/corkscrew.json">
        Corkscrew
      </button>
      <button class="bw-button level-button" data-level="levels/medium/three-pagodas.json">
        The Three Pagodas
      </button>
      <button class="bw-button level-button" data-level="levels/medium/proper-lock.json">
        Lock Picking
      </button>
      <h3>Hard</h3>
      <button class="bw-button level-button" data-level="levels/hard/yin-yang-full.json">
        Yin and Yang: Challenge
      </button>
      <button class="bw-button level-button" data-level="levels/hard/security-by-obscurity-lock.json">
        Security by Obscurity
      </button>
      <button class="bw-button level-button" data-level="levels/hard/I-tessellation-greedy-eyes.json">
        Greedy Eyes
      </button>
      <button class="bw-button level-button" data-level="levels/hard/the-finish-line.json">
        The Finish Line
      </button>
      <div style="opacity: 0.5" id="test-cases-not-real-levels" hidden>
        <h3>Test Cases</h3>
        <button class="bw-button level-button" data-level="levels/tests/move-right-to-win.json">
          Test Level 001 (Just move right to win)
        </button>
        <button class="bw-button level-button" data-level="levels/tests/move-left-to-win.json">
          Test Level 002 (Just move left to win)
        </button>
        <button class="bw-button level-button" data-level="levels/tests/test-level-with-no-goal.json">
          Test Level With No Goal
        </button>
        <button class="bw-button level-button" data-level="levels/tests/possible-bug-unable-to-move-left.json">
          Possible bug: unable to move left here?
        </button>
        <button class="bw-button level-button"
          data-level="levels/tests/three-overlapped-snakes-should-be-considered-valid.json">
          Three overlapped snakes should be considered valid
        </button>
        <button class="bw-button level-button" data-level="levels/tests/format-version-too-new.json">
          EMIT Format version too new (Error Message Itself Test)
        </button>
        <button class="bw-button level-button" data-level="levels/tests/crate-test.json">
          Crate Test
        </button>
        <button class="bw-button level-button" data-level="levels/tests/999-last-level-move-right-to-win.json">
          Test Level 999 (Just move right to win)
        </button>
      </div>
    </div>
  </div>
  <div class="screen safe-center" id="loading-screen">
    <div id="load-progress"></div>
  </div>
  <div class="screen safe-center splash-screen" id="level-splash">
    <div class="dummy-for-safe-center-child-margin"></div>
    <h1 id="level-splash-title"></h1>
    <div class="gong-effect"></div>
    <div class="dummy-for-safe-center-child-margin"></div>
  </div>
  <div class="screen safe-center" id="game-win-screen">
    <div class="dummy-for-safe-center-child-margin"></div>
    <h1>You Win!</h1>
    <blockquote id="tao-te-ching-quote">
      <div class="line-a">Thirty spokes share the wheel's hub;</div><br>
      <div class="line-b">It is the center hole that makes it useful.</div><br>
      <div class="line-a">Shape clay into a vessel;</div><br>
      <div class="line-b">It is the space within that makes it useful.</div><br>
      <div class="line-a">Cut doors and windows for a room;</div><br>
      <div class="line-b">It is the holes which make it useful.</div><br>
      <div class="line-a">Therefore profit comes from what is there;</div><br>
      <div class="line-b">Usefulness from what is not there.</div>

      <footer>
        &mdash; <cite>Tao Te Ching, Chapter 11</cite>
      </footer>
    </blockquote>
    <div class="gong-effect"></div>
    <div class="dummy-for-safe-center-child-margin"></div>
  </div>
  <div id="game-options-bar">
    <button class="bw-button" id="back-to-main-menu-button" aria-keyshortcuts="Escape">
      <img src="/graphics/back.svg" alt="" />
      <span class="button-text">Back</span>
    </button>
    <button class="bw-button level-flow-control-button hide-in-campaign" id="play-edit-toggle-button"
      aria-keyshortcuts="`">
      <!-- TODO: indicate toggle state -->
      <!-- I have sketched out an animation where the play icon triangle becomes the tip of a pencil and the whole button becomes a pencil,
      but it might be a lot of work and might just look silly. Could be fun though. -->
      <!-- <span style="font-size: 1.4em; font-family: monospace; font-variant-emoji: text; filter: grayscale(1)">
        ‚ñ∂&#xFE0E;/‚úè&#xFE0E;
      </span> -->
      <img src="/graphics/play-edit.svg" alt="" />
      <span class="button-text">Play/Edit</span>
    </button>
    <button class="bw-button level-flow-control-button" id="restart-level-button" aria-keyshortcuts="R">
      <img src="/graphics/restart.svg" alt="" />
      <span class="button-text">Restart Level</span>
    </button>
    <button class="bw-button level-flow-control-button" id="undo-button" aria-keyshortcuts="Z">
      <img src="/graphics/undo.svg" alt="" />
      <span class="button-text">Undo</span>
    </button>
    <button class="bw-button level-flow-control-button" id="redo-button" aria-keyshortcuts="Y">
      <img src="/graphics/undo.svg" alt="" style="transform: scaleX(-1)" />
      <span class="button-text">Redo</span>
    </button>
    <button class="bw-button" id="mute-button" aria-keyshortcuts="M" aria-pressed="false">
      <img src="/graphics/speaker.svg" alt="" class="when-unmuted" />
      <img src="/graphics/speaker-muted.svg" alt="" class="when-muted" />
      <span class="button-text" id="mute-button-text">Mute</span>
    </button>
    <button class="bw-button" id="hint-button" aria-keyshortcuts="Control+," aria-controls="hints-dialog">
      <img src="/graphics/hint-2.svg" alt="" />
      <span class="button-text">Hint</span>
    </button>
    <button class="bw-button" id="settings-button" aria-keyshortcuts="Control+," aria-controls="settings-dialog">
      <img src="/graphics/cog.svg" alt="" />
      <span class="button-text">Settings</span>
    </button>
    <button class="bw-button" id="fullscreen-button" aria-keyshortcuts="F">
      <!-- <img src="/graphics/fullscreen.svg" alt="" /> -->
      <img src="/graphics/move.svg" alt="" style="transform: rotate(45deg)" />
      <span class="button-text">Fullscreen</span>
    </button>
  </div>
  <div id="level-editor">
    <div id="entities-bar" class="safe-center">
      <button class="bw-button tool-button entity-button" data-entity="Snake" data-color="White">
        <span class="button-text">Snake (White)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Snake" data-color="Black">
        <span class="button-text">Snake (Black)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Food" data-color="White">
        <span class="button-text">Food (White)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Food" data-color="Black">
        <span class="button-text">Food (Black)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Inverter" data-color="Both">
        <span class="button-text">Inverter</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Crate" data-color="White">
        <span class="button-text">Crate (White)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Crate" data-color="Black">
        <span class="button-text">Crate (Black)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Block" data-color="White">
        <span class="button-text">Wall (White)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Block" data-color="Black">
        <span class="button-text">Wall (Black)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Block" data-color="Both">
        <span class="button-text">Wall (Both)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="Block" data-color="None">
        <!-- <span class="button-text">Floor (Either)</span> -->
        <span class="button-text">Grass</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="CellularAutomata" data-color="White">
        <span class="button-text">Life (White)</span>
      </button>
      <button class="bw-button tool-button entity-button" data-entity="CellularAutomata" data-color="Black">
        <span class="button-text">Life (Black)</span>
      </button>
      <!-- entity buttons are brush tools -->
      <!-- <button class="bw-button tool-button" data-tool="Brush">Brush</button> -->
      <button class="bw-button tool-button" data-tool="Eraser">
        <img src="/graphics/eraser.svg" alt="" />
        <span class="button-text">Eraser</span>
      </button>
      <button class="bw-button tool-button" data-tool="Select">
        <img src="/graphics/select.svg" alt="" />
        <span class="button-text">Select</span>
      </button>
      <button class="bw-button tool-button" data-tool="Move">
        <img src="/graphics/move.svg" alt="" />
        <span class="button-text">Move</span>
      </button>
      <button class="bw-button" id="clear-button" aria-keyshortcuts="Delete">
        <img src="/graphics/trash.svg" alt="" />
        <span class="button-text">Clear</span>
      </button>
      <button class="bw-button" id="invert-button" aria-keyshortcuts="I">
        <img src="/graphics/invert-9.svg" alt="" />
        <!-- <span style="font-size: 2.4em; font-family: monospace; font-variant-emoji: text; filter: grayscale(1)">
          ‚òØ&#xFE0E;
        </span> -->
        <span class="button-text">Invert</span>
      </button>
      <button class="bw-button" id="level-info-button" aria-controls="level-info-editor" aria-keyshortcuts="Alt+E">
        <img src="/graphics/level-info.svg" alt="" />
        <span class="button-text">Level Info</span>
      </button>
      <button class="bw-button" id="save-button" aria-keyshortcuts="Control+S Meta+S">
        <img src="/graphics/save.svg" alt="" />
        <!-- <span style="font-size: 1.4em; font-family: monospace; font-variant-emoji: text; filter: grayscale(1)">
          üíæ&#xFE0E;
        </span> -->
        <span class="button-text">Save</span>
      </button>
      <button class="bw-button" id="open-button" aria-keyshortcuts="Control+O Meta+O">
        <img src="/graphics/open.svg" alt="" />
        <!-- <span style="font-size: 1.4em; font-family: monospace; font-variant-emoji: text; filter: grayscale(1)">
          üìÇ&#xFE0E;
        </span> -->
        <span class="button-text">Open</span>
      </button>
    </div>
    <!-- <div id="toolbar">
      <button id="play-button">Play</button>
      <button id="save-button">Save</button>
      <button id="load-button">Load</button>
      <button id="clear-button">Clear</button>
      <button id="undo-button">Undo</button>
      <button id="redo-button">Redo</button>
    </div> -->
    <dialog id="level-info-editor">
      <h2>Level Info</h2>
      <form method="dialog">
        <!-- <div class="control-row">
          <label for="level-title">Title:</label>
          <input type="text" id="level-title" />
        </div>
        <div class="control-row">
          <label for="level-author">Author:</label>
          <input type="text" id="level-author" />
        </div>
        <div class="control-row">
          <label for="level-description">Description:</label>
          <textarea id="level-description"></textarea>
        </div> -->
        <div class="control-row">
          <label for="level-width">Width:</label>
          <input type="number" id="level-width" />
        </div>
        <div class="control-row">
          <label for="level-height">Height:</label>
          <input type="number" id="level-height" />
        </div>
        <div class="control-row">
          <button value="ok" class="bw-button" id="level-info-editor-ok-button">OK</button>
          <button value="cancel" formmethod="dialog" class="bw-button"
            id="level-info-editor-cancel-button">Cancel</button>
        </div>
      </form>
    </dialog>
  </div>
  <div id="replay-bar" class="safe-center">
    <!-- <button class="bw-button" id="replay-play-pause-button" aria-keyshortcuts="Space">
      <span>‚ñ∂</span>
      <span class="button-text">Play</span>
    </button> -->
    <input type="range" id="replay-slider" min="0" max="0" step="1" value="0" />
  </div>
  <div class="level-specific-overlay" data-for-level="levels/easy/001-movement.json" hidden>
    <!-- <h2>How to Move</h2> -->
    <!-- <p>You can use a gamepad, keyboard, mouse, pen, or touch to play.</p> -->
    <p class="keyboard-only">
      Use the arrow keys
      <span style="display: inline-block;">
        <kbd style="opacity:0;user-select:none;margin-bottom:-0.1em" aria-hidden="true">_</kbd><!--
          --><kbd style="margin-bottom:-0.1em">‚Üë</kbd><!--
          --><br style="user-select:none" aria-hidden="true"><!--
          --><kbd>‚Üê</kbd><kbd>‚Üì</kbd><kbd>‚Üí</kbd>
      </span>
      or
      <span style="display: inline-block;">
        <kbd style="opacity:0;user-select:none;margin-bottom:-0.1em;margin-left:-0.2em" aria-hidden="true">Q</kbd><!--
          --><kbd style="margin-bottom:-0.1em">W</kbd><!--
          --><br style="user-select:none" aria-hidden="true"><!--
          --><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd>
      </span>
      or
      <!-- vi-style -->
      <!-- vi keys -->
      <span style="display: inline-block;">
        <kbd>H</kbd><kbd>J</kbd><kbd>K</kbd><kbd>L</kbd>
      </span>
      or numpad
      <span style="display: inline-block;">
        <kbd style="opacity:0;user-select:none;margin-bottom:-0.1em" aria-hidden="true">7</kbd><!--
          --><kbd style="margin-bottom:-0.1em">8</kbd><br style="user-select:none" aria-hidden="true"><!--
          --><kbd>4</kbd><kbd>5</kbd><kbd>6</kbd>
      </span>
    </p>
    <p class="gamepad-only">
      Either use the <big>‚úú</big> D-pad, or press <big>‚í∂</big> while holding the left stick in a direction.
    </p>
    <p class="pointer-only">
      Drag anywhere to move in a given direction.
    </p>
    <p class="keyboard-only">
      (Gamepad, mouse, and touch controls are also available.)
    </p>
    <p class="gamepad-only">
      (Keyboard, mouse, and touch controls are also available.)
    </p>
    <p class="pointer-only">
      (Keyboard and gamepad controls are also available.)
    </p>
  </div>
  <div class="level-specific-overlay" data-for-level="levels/easy/002-switching-snakes.json" hidden>
    <!-- <h2>How to Switch Snakes</h2> -->
    <p class="keyboard-only">
      Press <kbd>Tab</kbd> to switch snakes.
    </p>
    <p class="gamepad-only">
      Use the shoulder buttons to switch snakes.
    </p>
    <p class="pointer-only">
      Click or tap a snake to switch to it.
    </p>
  </div>
  <div class="level-specific-overlay" data-for-level="levels/easy/004-ferry.json" hidden>
    <!-- <h2>How to Undo</h2> -->
    <p class="keyboard-only">
      You can press <kbd>Z</kbd> to undo, or <kbd>R</kbd> to restart the level.
    </p>
    <p class="gamepad-only">
      You can press <big>‚ìß</big> to undo, or <big>‚ìé</big> to restart the level.
    </p>
    <!-- TODO: for non-touch pointer devices, show keyboard shortcuts? -->
    <p class="pointer-only">
      You can press <img src="/graphics/undo.svg" alt="the curved left arrow button"
        style="filter: invert(); vertical-align: middle; height: 2em" /> to undo,
      or <img src="/graphics/restart.svg" alt="the circular arrow button"
        style="filter: invert(); vertical-align: middle; height: 2em" /> to restart the level.
    </p>
  </div>
  <div id="level-stuck-hint" hidden>
    <!-- Want neutral language that doesn't imply you're having trouble. -->
    <!-- <h2>Stuck?</h2> -->
    <p class="keyboard-only">
      Press <kbd>Z</kbd> to undo or <kbd>R</kbd> to restart
    </p>
    <p class="gamepad-only">
      Press <big>‚ìß</big> to undo or <big>‚ìé</big> to restart
    </p>
    <!-- TODO: for non-touch pointer devices, show keyboard shortcuts? -->
    <p class="pointer-only">
      Press <img src="/graphics/undo.svg" alt="the curved left arrow button"
        style="filter: invert(); vertical-align: middle; height: 2em" /> to undo
      or <img src="/graphics/restart.svg" alt="the circular arrow button"
        style="filter: invert(); vertical-align: middle; height: 2em" /> to restart
    </p>
  </div>
  <dialog id="settings-dialog">
    <h2>Settings</h2>
    <form method="dialog">
      <!-- <div class="control-row">
        <label for="settings-music-volume">Music Volume:</label>
        <input type="range" id="settings-music-volume" min="0" max="1" step="0.01" />
      </div>
      <div class="control-row">
        <label for="settings-sfx-volume">Sound Effects Volume:</label>
        <input type="range" id="settings-sfx-volume" min="0" max="1" step="0.01" />
      </div> -->
      <!-- <div class="control-row">
        <label for="settings-key-repeat-rate">Key Repeat Rate (ms):</label>
        <input type="number" id="settings-key-repeat-rate" min="0" max="1000" step="1" />
      </div> -->
      <fieldset>
        <legend>Gamepad</legend>
        <p class="fieldset-description">
          Control how long you have to hold a button on the directional pad before it starts repeating,
          and how quickly it repeats.
        </p>
        <div class="control-row">
          <label for="settings-gamepad-repeat-delay">Button Repeat Delay (ms):</label>
          <input type="number" id="settings-gamepad-repeat-delay" min="0" max="1000" step="1" />
        </div>
        <div class="control-row">
          <label for="settings-gamepad-repeat-rate">Button Repeat Rate (ms):</label>
          <input type="number" id="settings-gamepad-repeat-rate" min="0" max="1000" step="1" />
        </div>
      </fieldset>
      <fieldset>
        <!-- <legend>Pointer (mouse/pen/touch)</legend> -->
        <!-- <legend>Mouse, Pen, and Touch</legend> -->
        <legend>Mouse / Pen / Touch</legend>
        <p class="fieldset-description">
          Control the sensitivity of swiping to move the snake.
          Lower values are more sensitive.
        </p>
        <div class="control-row">
          <label for="settings-pointer-move-threshold">Move Threshold (pixels):</label>
          <input type="number" id="settings-pointer-move-threshold" min="0" max="100" step="1" />
        </div>
      </fieldset>
      <fieldset>
        <legend>Haptics</legend>
        <p class="fieldset-description">
          Haptic feedback is supported for both mobile devices and gamepads.
        </p>
        <div class="checkbox-control-row control-row">
          <input type="checkbox" id="settings-haptics-enabled" />
          <label for="settings-haptics-enabled">Enable haptic feedback</label>
        </div>
        <div class="control-row enabled-by-haptics">
          <label for="settings-haptics-valid-move-ms">Valid move vibration (ms):</label>
          <input type="number" id="settings-haptics-valid-move-ms" min="0" max="300" step="1" value="6" />
        </div>
        <div class="control-row enabled-by-haptics">
          <label for="settings-haptics-invalid-move-ms">Invalid move vibration (ms):</label>
          <input type="number" id="settings-haptics-invalid-move-ms" min="0" max="300" step="1" value="60" />
        </div>
      </fieldset>
      <div class="buttons-control-row control-row">
        <button value="ok" class="bw-button" id="settings-dialog-ok-button">OK</button>
        <button value="cancel" formmethod="dialog" class="bw-button" id="settings-dialog-cancel-button">Cancel</button>
      </div>
    </form>
  </dialog>
  <dialog id="hints-dialog">
    <h2>Hints</h2>
    <ol id="hints-list"></ol>
    <form method="dialog">
      <div class="buttons-control-row control-row">
        <button value="ok" class="bw-button" id="hints-dialog-ok-button">OK</button>
        <button type="button" class="bw-button" id="hints-dialog-next-hint-button" style="flex-direction: row">
          <img src="/graphics/hint-2.svg" alt="" />
          <span class="button-text">Next Hint</span>
        </button>
      </div>
    </form>
  </dialog>
  <script type="module" src="./main.ts"></script>
  <script>
    setTimeout((function () {
      for (var i = 0; i < document.scripts.length; i++) {
        var script = document.scripts[i]
        var maxLength = 100
        console.log(script.outerHTML.slice(0, maxLength) + (script.outerHTML.length > maxLength ? '...' : ''))
      }
    }), 0)
  </script>
</body>

</html>
